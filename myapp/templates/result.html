
{% extends "base.html" %}
{% load static %}
{% load humanize %}

{% block content %}

<div>
    <div class="mx-auto max-w-7xl mt-8 px-4 sm:px-6 lg:px-8">
        <div class="sm:flex sm:items-center">
            <div class="sm:flex-auto">
                <h1
                    class=" text-xl font-semibold leading-6 text-gray-900">Hasil
                    Rekonsiliasi</h1>
                    <p class="text-sm">Rekonsiliasi Data Tagihan Fuel IAA - {{ latest_result.fuel_agent }} <span class="text-red-600">{{ latest_result.data_start_date|date:" N j, Y"  }}</span>  sampai <span class="text-red-600">{{ latest_result.data_end_date|date:" N j, Y" }}</span>  </p>
            </div>
            <div class="mt-4 sm:ml-16 sm:mt-0 flex ">
                <form method="post">
                    {% csrf_token %}
                    <button class="block  rounded-md bg-white mr-1 px-2 py-2 text-center text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50" type="submit" name="export_pdf" value="true">Export as PDF</button>
                </form>
            </div>
        </div>
        <div class="py-5">
            <dl class="grid grid-cols-1 gap-5 sm:grid-cols-3  mb-2">
              <div class="overflow-hidden rounded-lg bg-white px-4 py-5 shadow sm:p-6">
                <dt class="truncate text-sm font-medium text-gray-500">Total Uplift in Lts by IAA</dt>
                <dd class="mt-1 text-3xl font-semibold tracking-tight text-gray-900">{{ latest_result.total_uplift_in_lts_occ|floatformat:"-0"|intcomma }}</dd>
              </div>
              <div class="overflow-hidden rounded-lg bg-white px-4 py-5 shadow sm:p-6">
                <dt class="truncate text-sm font-medium text-gray-500">Total Uplift in Lts by Vendor</dt>
                <dd class="mt-1 text-3xl font-semibold tracking-tight text-gray-900">{{ latest_result.total_uplift_in_lts_ven|floatformat:"-0"|intcomma }}</dd>
              </div>
              <div class="overflow-hidden rounded-lg bg-white px-4 py-5 shadow sm:p-6">
                <dt class="truncate text-sm font-medium text-gray-500">Total Selisih</dt>
                <dd class="mt-1 text-3xl font-semibold tracking-tight text-gray-900">{{ latest_result.total_selisih|floatformat:"-0"|intcomma }}</dd>
              </div>
            </dl>
        </div>
    </div>
    {% if latest_detail_results %}
    <div class="container p-2 mx-auto sm:p-4 ">
        <p class="text-sm font-semibold leading-6 text-gray-600 pb-2"> <span class="text-red-600">**</span> Daftar Tagihan pembelian Fuel dari vendor yang tidak sesuai dengan rekaman IAA</p>
        <div class="overflow-x-auto">
            <table class="min-w-full text-xs">
                <colgroup>
                    <col>
                    <col>
                    <col>
                    <col>
                    <col>
                    <col class="w-24">
                </colgroup>
                <thead class="dark:bg-gray-300 ">
                    <tr class="text-left">
                        <th class="p-3">Invoice #</th>
                        <th class="hidden sm:table-cell p-3">Date</th>
                        <th class="hidden sm:table-cell p-3">Flight</th>
                        <th class="hidden sm:table-cell p-3">Dep</th>
                        <th class="hidden sm:table-cell p-3 ">Arr</th>
                        <th class="hidden sm:table-cell p-3 ">Reg</th>
                        <th class="hidden sm:table-cell p-3 ">Fuel Agent Name</th>
                        <th class="p-3 ">Uplift In Lts By IAA</th>
                        <th class="p-3 ">Uplift In Lts By Fuel Agent</th>
                        <th class="pr-3">Selisih</th>
                    </tr>
                </thead>
                <tbody>
                  {% for detail_result in latest_detail_results %}
                  <tr class="border-b border-opacity-20 dark:border-gray-300 dark:bg-gray-50">
                      <td class="p-3">
                          <p>{{ detail_result.invoice_no }}</p>
                      </td>
                      <td class="p-3 hidden sm:table-cell">
                          <p>{{ detail_result.date_occ|date:"Y-m-d" }}</p>
                      </td>
                      <td class="p-3 hidden sm:table-cell">
                          <p class="dark:text-gray-600">{{ detail_result.flight_occ }}</p>
                      </td>
                      <td class="p-3 hidden sm:table-cell">
                          <p class="dark:text-gray-600">{{ detail_result.departure_occ }}</p>
                      </td>
                      <td class="p-3  hidden sm:table-cell">
                          <p>{{ detail_result.arrival_occ }}</p>
                      </td>
                      <td class="p-3  hidden sm:table-cell">
                          <p>{{ detail_result.registration_occ }}</p>
                      </td>
                      <td class="p-3  hidden sm:table-cell">
                          <p>{{ detail_result.fuel_agent }}</p>
                      </td>
                      <td class="p-3 text-center">
                          <span class="rounded-md whitespace-nowrap mt-0.5 px-2 py-0.5 text-sm font-medium bg-green-200">{{ detail_result.uplift_in_lts_occ|floatformat:"-0"|intcomma}}</span>
                      </td>
                      <td class="p-3 text-center">
                          <span class="rounded-md whitespace-nowrap mt-0.5 px-2 py-0.5 text-sm font-medium bg-green-200">{{ detail_result.uplift_in_lts_ven|floatformat:"-0"|intcomma }}</span>
                      </td>
                      
                      <td class="p-3 ">
                          <span class="rounded-md whitespace-nowrap mt-0.5 px-2 py-0.5 text-sm font-medium bg-red-200">{{ detail_result.selisih|floatformat:"-0"|intcomma }}</span>
                      </td>
                  </tr>
                  {% endfor %}
                    </tbody>
            </table>
        </div>
    </div>
    {% else %}
    <div class="flex justify-center items-center h-screen border -mt-10">
        <div class=" bg-white p-8 rounded-lg border">
            <div class="mx-auto flex h-16 w-16 items-center justify-center rounded-full bg-green-100">
                <svg class="h-6 w-6 text-green-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                </svg>
              </div>
            <h2 class="text-xl mt-4 font-semibold text-gray-800 text-center mb-2">Tidak Ada Perbedaan yang Ditemukan</h2>
        </div>
    </div>
    {% endif %}

{% if latest_missing_invoices_in_vendor %}
    <div class="flow-root overflow-hidden  mt-20 mb-10">
        <div class="sm:flex sm:items-center">
          <div class="sm:flex-auto">
            <p class="px-6 mt-2 text-sm text-gray-700"><span class=" text-red-600 text-xl">**</span>Data dari {{ latest_result.fuel_agent }} Tidak Ditemukan dalam Rekaman IAA.</p>
          </div>
        </div>
        <div class=" container p-2 mx-auto sm:p-4 ">
            <div class="overflow-x-auto ">
                <table class="min-w-full text-xs">
                    <colgroup>
                        <col>
                        <col>
                        <col>
                        <col>
                        <col>
                        <col class="w-24">
                    </colgroup>
                    <thead class="dark:bg-gray-300 ">
                        <tr class="text-left">
                            <th class="p-3">Invoice #</th>
                            <th class="hidden sm:table-cell p-3">Date</th>
                            <th class="hidden sm:table-cell p-3">Flight</th>
                            <th class="hidden sm:table-cell p-3">Dep</th>
                            <th class="hidden sm:table-cell p-3 ">Arr</th>
                            <th class="hidden sm:table-cell p-3 ">Reg</th>
                            <th class="hidden sm:table-cell p-3 ">Fuel Agent Name</th>
                            <th class="p-3 ">Uplift In Lts By IAA</th>
                        </tr>
                    </thead>
                    <tbody>
                      {% for missing_invoices_in_vendor  in latest_missing_invoices_in_vendor %}
                        <tr class="border-b border-opacity-20 dark:border-gray-300 dark:bg-gray-50">
                            <td class="p-3">
                                <p>{{ missing_invoices_in_vendor.invoice_no }}</p>
                            </td>
                            <td class="p-3 hidden sm:table-cell">
                                <p>{{ missing_invoices_in_vendor.date|date:"Y-m-d" }}</p>
                            </td>
                            
                            <td class="p-3 hidden sm:table-cell">
                                <p class="dark:text-gray-600">{{ missing_invoices_in_vendor.flight }}</p>
                            </td>
                            <td class="p-3 hidden sm:table-cell">
                                <p class="dark:text-gray-600">{{ missing_invoices_in_vendor.departure }}</p>
                            </td>
                            <td class="p-3  hidden sm:table-cell">
                                <p>{{ missing_invoices_in_vendor.arrival }}</p>
                            </td>
                            <td class="p-3  hidden sm:table-cell">
                                <p>{{ missing_invoices_in_vendor.registration }}</p>
                            </td>
                            <td class="p-3  hidden sm:table-cell">
                                <p>{{ missing_invoices_in_vendor.fuel_agent }}</p>
                            </td>
                            <td class="p-3">
                                <span class="rounded-md whitespace-nowrap mt-0.5 px-2 py-0.5 text-sm font-medium bg-red-200">{{ missing_invoices_in_vendor.uplift_in_lts|floatformat:"-0"|intcomma }}</span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                  </table>
            <div class="flex justify-end mr-40 mt-5 ">
                <h1 class=" font-bold">Total : <span>{{ total_missing_invoices_in_vendor|intcomma }}</span></h1>
            </div>
            </div>
          
        </div>
    </div>
{% endif %}
      

{% if latest_missing_invoices_in_occ %}
    <div class="flow-root overflow-hidden  mt-20 mb-10">
        <div class="sm:flex sm:items-center">
          <div class="sm:flex-auto">
            <p class="px-6 mt-2 text-sm text-gray-700"><span class=" text-red-600 text-xl">**</span>Data dari {{ latest_result.fuel_agent }} Tidak Ditemukan dalam Rekaman IAA.</p>
          </div>
        </div>
        <div class=" container p-2 mx-auto sm:p-4 ">
            <div class="overflow-x-auto ">
                <table class="min-w-full text-xs">
                    <colgroup>
                        <col>
                        <col>
                        <col>
                        <col>
                        <col>
                        <col class="w-24">
                    </colgroup>
                    <thead class="dark:bg-gray-300 ">
                        <tr class="text-left">
                            <th class="p-3">Invoice #</th>
                            <th class="hidden sm:table-cell p-3">Date</th>
                            <th class="hidden sm:table-cell p-3">Flight</th>
                            <th class="hidden sm:table-cell p-3">Dep</th>
                            <th class="hidden sm:table-cell p-3 ">Arr</th>
                            <th class="hidden sm:table-cell p-3 ">Reg</th>
                            <th class="hidden sm:table-cell p-3 ">Fuel Agent Name</th>
                            <th class="p-3 ">Uplift In Lts By IAA</th>
                        </tr>
                    </thead>
                    <tbody>
                      {% for latest_missing_invoices_in_occ  in latest_missing_invoices_in_occ %}
                        <tr class="border-b border-opacity-20 dark:border-gray-300 dark:bg-gray-50">
                            <td class="p-3">
                                <p>{{ latest_missing_invoices_in_occ.invoice_no }}</p>
                            </td>
                            <td class="p-3 hidden sm:table-cell">
                                <p>{{ latest_missing_invoices_in_occ.date|date:"Y-m-d" }}</p>
                            </td>
                            
                            <td class="p-3 hidden sm:table-cell">
                                <p class="dark:text-gray-600">{{ latest_missing_invoices_in_occ.flight }}</p>
                            </td>
                            <td class="p-3 hidden sm:table-cell">
                                <p class="dark:text-gray-600">{{ latest_missing_invoices_in_occ.departure }}</p>
                            </td>
                            <td class="p-3  hidden sm:table-cell">
                                <p>{{ latest_missing_invoices_in_occ.arrival }}</p>
                            </td>
                            <td class="p-3  hidden sm:table-cell">
                                <p>{{ latest_missing_invoices_in_occ.registration }}</p>
                            </td>
                            <td class="p-3  hidden sm:table-cell">
                                <p>{{ latest_missing_invoices_in_occ.fuel_agent }}</p>
                            </td>
                            <td class="p-3">
                                <span class="rounded-md whitespace-nowrap mt-0.5 px-2 py-0.5 text-sm font-medium bg-red-200">{{ latest_missing_invoices_in_occ.uplift_in_lts|floatformat:"-0"|intcomma }}</span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                  </table>
            <div class="flex justify-end mr-40 mt-5 ">
                <h1 class=" font-bold">Total : <span>{{ total_missing_invoices_in_occ|intcomma }}</span></h1>
            </div>
            </div>
          
        </div>
    </div>
{% endif %}

    
</div>

{% endblock %}